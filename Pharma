<!DOCTYPE html>
<html lang="en">
<head>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Medical & Medicine Entry</title>

<style>
    body {
        font-family: Arial, sans-serif;
        padding: 30px;
    }
    .box {
        width: 400px;
        position: relative;
        margin: auto;
    }
    input {
        width: 100%;
        padding: 10px;
        margin-bottom: 8px;
        font-size: 16px;
    }
    .suggestions {
        position: absolute;
        background: white;
        border: 1px solid #ccc;
        width: 100%;
        max-height: 150px;
        overflow-y: auto;
        display: none;
        z-index: 100;
    }
    .suggestions div {
        padding: 10px;
        cursor: pointer;
    }
    .suggestions div:hover {
        background: #f1f1f1;
    }
    button {
        width: 100%;
        padding: 12px;
        background: green;
        color: white;
        border: none;
        font-size: 18px;
        cursor: pointer;
        margin-top: 5px;
    }
    table {
        width: 90%;
        margin: 25px auto;
        border-collapse: collapse;
    }
    th, td {
        border: 1px solid black;
        padding: 8px;
    }
    th {
        background: #eef0f4;
    }
</style>

</head>
<body>

<h2 style="text-align:center;">Medical Billing Input</h2>

<div class="box">

    <!-- MEDICAL NAME SEARCH -->
    <input type="text" id="medicalName" placeholder="Search Medical Name">
    <div class="suggestions" id="medicalSuggest"></div>

    <!-- MEDICINE NAME SEARCH -->
    <input type="text" id="medicine" placeholder="Search Medicine Name">
    <div class="suggestions" id="medicineSuggest"></div>

    <input type="number" id="quantity" placeholder="Quantity">
    <input type="text" id="free" placeholder="Free Text / Notes">

    <button onclick="addEntry()">Add</button>
</div>

<table>
    <thead>
        <tr>
            <th>Medical Name</th>
            <th>Medicine Name</th>
            <th>Quantity</th>
            <th>Notes</th>
        </tr>
    </thead>
    <tbody id="outputTable"></tbody>
    
</table>
<button onclick="downloadPDF()" style="background:crimson;margin-top:10px;">
    Download Data (PDF)
</button>
<script>
async function downloadPDF() {
    const { jsPDF } = window.jspdf;

    let doc = new jsPDF();
    let y = 20;

    doc.setFontSize(18);
    doc.text("Medical Billing Data", 14, y);
    y += 10;

    doc.setFontSize(12);

    let rows = document.querySelectorAll("table tr");

    rows.forEach((row, index) => {
        let cols = row.querySelectorAll("td, th");
        let line = [];

        cols.forEach(col => {
            line.push(col.innerText);
        });

        doc.text(line.join(" | "), 10, y);
        y += 10;

        if (y > 280) {
            doc.addPage();
            y = 20;
        }
    });

    doc.save("medical_data.pdf");
}
    /* -----------------------------
       LIST OF MEDICAL SHOPS
    ----------------------------- */
    const medicalList = [
        "Apollo Pharmacy",
        "MedPlus Medical Store",
        "Wellness Forever",
        "Netmeds Store",
        "Guardian Pharmacy",
        "Life Care Medicals",
        "Health Point Medical",
        "City Medical Store"
    ];

    /* -----------------------------
       LIST OF MEDICINES
    ----------------------------- */
    const medicineList = [
        "Paracetamol",
        "Dolo 650",
        "Azithromycin",
        "Amoxicillin",
        "Ibuprofen",
        "Cetirizine",
        "Cough Syrup",
        "Pantoprazole",
        "Vitamin C",
        "Metformin",
        "Insulin"
    ];

    /* ------------------------------------------
       GENERIC AUTOCOMPLETE FUNCTION
    ------------------------------------------ */
    function setupAutocomplete(inputId, suggestionId, listArray) {
        const input = document.getElementById(inputId);
        const suggestBox = document.getElementById(suggestionId);

        input.addEventListener("input", function () {
            let value = this.value.toLowerCase();
            suggestBox.innerHTML = "";

            if (value === "") {
                suggestBox.style.display = "none";
                return;
            }

            let filtered = listArray.filter(item =>
                item.toLowerCase().includes(value)
            );

            if (filtered.length === 0) {
                suggestBox.style.display = "none";
            } else {
                suggestBox.style.display = "block";

                filtered.forEach(item => {
                    let div = document.createElement("div");
                    div.textContent = item;

                    div.onclick = function () {
                        input.value = item;
                        suggestBox.style.display = "none";
                    };

                    suggestBox.appendChild(div);
                });
            }
        });
    }

    // Activate autocomplete for both fields
    setupAutocomplete("medicalName", "medicalSuggest", medicalList);
    setupAutocomplete("medicine", "medicineSuggest", medicineList);


    /* ------------------------------------------
       ADD ENTRY TO TABLE
    ------------------------------------------ */
    function addEntry() {
        let medStore = document.getElementById("medicalName").value;
        let medName = document.getElementById("medicine").value;
        let qty = document.getElementById("quantity").value;
        let notes = document.getElementById("free").value;

        if (medStore === "" || medName === "") {
            alert("Please select both medical name and medicine name.");
            return;
        }

        let table = document.getElementById("outputTable");

        table.innerHTML += `
            <tr>
                <td>${medStore}</td>
                <td>${medName}</td>
                <td>${qty}</td>
                <td>${notes}</td>
            </tr>
        `;

        // Clear fields
        document.getElementById("medicalName").value = "";
        document.getElementById("medicine").value = "";
        document.getElementById("quantity").value = "";
        document.getElementById("free").value = "";
    }

</script>

</body>
</html>
